---
import { ClientRouter } from 'astro:transitions';

import Navbar from '../components/ui/Navbar.astro';
import Head from '../components/Head.astro';

import { getNavigation, features } from '@/data/navigation';
import { hasPublishedBlogPosts } from '@/lib/content';
import { seo, template, analytics } from '../settings';
import Footer from '../components/ui/Footer.astro';

import '@fontsource-variable/manrope';
import '@fontsource-variable/fraunces';
import '@fontsource-variable/jetbrains-mono';
import '@fontsource-variable/source-serif-4';

type Props = {
  title?: string;
  description?: string;
  image?: string;
  showFooter?: boolean;
};

const {
  title = seo.default_title,
  description = seo.default_description,
  image = seo.default_image,
  showFooter = true,
} = Astro.props;

const blogAvailable = await hasPublishedBlogPosts();
const navigation = getNavigation({
  blogAvailable,
  blogNavMode: features.blogNav,
});
const { internal: navItems, external: externalLinks } = navigation;
---

<!doctype html>
<html lang="en" data-theme={template.darkTheme}>
  <head>
    {template.transitions && <ClientRouter />}

    <Head title={title} description={description} image={image} />
    {
      analytics.goatcounterEndpoint && (
        <script
          is:inline
          data-goatcounter={analytics.goatcounterEndpoint}
          async
          src="https://gc.zgo.at/count.js"
        />
      )
    }
  </head>
  <body
    class:list={{
      'font-sans antialiased': template.bodyFont === 'sans',
      'font-serif antialiased': template.bodyFont === 'serif',
    }}
  >
    <div class="bg-base-100 min-h-screen">
      <Navbar items={navItems} externalLinks={externalLinks} />
      <main
        class:list={[
          'mx-auto flex min-h-[calc(100vh-5rem)] w-full max-w-5xl flex-col gap-16 px-6 py-12 text-[1.05rem] leading-relaxed text-base-content/90',
          {
            '[&_h1]:font-display': template.displayFont === 'display',
            '[&_h2]:font-display': template.displayFont === 'display',
            '[&_h3]:font-display': template.displayFont === 'display',
            '[&_h4]:font-display': template.displayFont === 'display',
            '[&_h1]:font-serif': template.displayFont === 'serif',
            '[&_h2]:font-serif': template.displayFont === 'serif',
            '[&_h3]:font-serif': template.displayFont === 'serif',
            '[&_h4]:font-serif': template.displayFont === 'serif',
            '[&_h1]:font-sans': template.displayFont === 'sans',
            '[&_h2]:font-sans': template.displayFont === 'sans',
            '[&_h3]:font-sans': template.displayFont === 'sans',
            '[&_h4]:font-sans': template.displayFont === 'sans',
            '[&_h1]:text-base-content': true,
            '[&_h2]:text-base-content': true,
            '[&_h3]:text-base-content': true,
            '[&_h4]:text-base-content': true,
            '[&_h1]:leading-tight': true,
            '[&_h2]:leading-tight': true,
            '[&_h3]:leading-tight': true,
            '[&_h4]:leading-tight': true,
            '[&_h1]:tracking-tight': true,
            '[&_h2]:tracking-tight': true,
            '[&_h3]:tracking-tight': true,
            '[&_h4]:tracking-tight': true,
          },
        ]}
      >
        <slot />
        {showFooter && <Footer />}
      </main>
    </div>
  </body>
</html>

<style>
  html,
  body {
    margin: 0;
    width: 100%;
    height: 100%;
  }
</style>

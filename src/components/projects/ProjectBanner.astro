---
import type { ProjectBanner } from '@/lib/content';

type Props = {
  banner: ProjectBanner;
};

const { banner } = Astro.props as Props;
const { image } = banner;
const captionPlacement = banner.captionPlacement ?? 'below';
const hasCaption = Boolean(banner.caption);
const captionAbove = hasCaption && captionPlacement === 'above';
const captionBelow = hasCaption && captionPlacement !== 'above';

if (image.width <= 0 || image.height <= 0) {
  throw new Error(
    `Project banner "${banner.alt}" is missing image dimensions.`,
  );
}
---

<figure class="project-banner-frame">
  {
    captionAbove && (
      <figcaption class="project-banner-caption liquid-caption mb-3">
        {banner.caption}
      </figcaption>
    )
  }
  <img
    src={image.src}
    alt={banner.alt}
    width={image.width}
    height={image.height}
    loading="lazy"
    decoding="async"
    class="project-banner-image block w-full h-auto object-contain"
  />
  {
    captionBelow && (
      <figcaption class="project-banner-caption liquid-caption mt-3">
        {banner.caption}
      </figcaption>
    )
  }
</figure>

<style>
  .project-banner-frame {
    margin: 0;
  }

  .project-banner-caption {
    display: inline-flex;
    align-items: center;
    width: fit-content;
    max-width: min(100%, 34rem);
    padding: 0.5rem 0.7rem;
    border-radius: 0.7rem;
    text-align: center;
    font-size: 0.72rem;
    line-height: 1.4;
    letter-spacing: 0.02em;
  }

  .project-banner-image {
    background: #fff;
    border-radius: 0.8rem;
    padding: 0.72rem;
    box-shadow: var(--site-media-depth-shadow);
  }
</style>

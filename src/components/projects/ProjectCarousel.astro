---
/*
--------------------------------------------------------------------------------
personal-site
src/components/projects/ProjectCarousel.astro

Renders the projects carousel with navigation controls.

Module Author(s): Eric J. South
--------------------------------------------------------------------------------
*/

import ProjectCarouselNav from '@/components/projects/ProjectCarouselNav.astro';
import ProjectCarouselSideControl from '@/components/projects/ProjectCarouselSideControl.astro';
import ProjectPanel from '@/components/projects/ProjectPanel.astro';
import type { ProjectPanel as ProjectPanelType } from '@/lib/projects';
import '@/styles/project-carousel.css';

type Props = {
  projects: ProjectPanelType[];
  class?: string;
};

const { projects, class: className } = Astro.props as Props;

if (!Array.isArray(projects) || projects.length === 0) {
  throw new Error('Project carousel is missing projects.');
}

const classes = [
  'relative flex flex-col gap-4 project-carousel',
  className ?? '',
]
  .join(' ')
  .trim();

const projectMeta = projects.map((project) => {
  const slug = project.entry.slug;
  if (!slug) {
    throw new Error('Project entry slug is missing.');
  }
  return {
    id: `project-${slug}`,
    title: project.entry.data.title,
  };
});
---

<section
  class={classes}
  data-project-carousel
  aria-roledescription="carousel"
  aria-label="Projects carousel"
>
  <div class="project-carousel-frame relative">
    <div class="project-carousel-grid grid">
      <div
        class="pointer-events-none project-carousel-nav-layer col-start-1 row-start-1 z-10"
      >
        <div class="story-carousel-side">
          <ProjectCarouselSideControl direction="prev" />
        </div>
      </div>
      <div
        class="pointer-events-none project-carousel-nav-layer col-start-1 row-start-1 z-10"
      >
        <div class="story-carousel-side story-carousel-side--right">
          <ProjectCarouselSideControl direction="next" />
        </div>
      </div>
      <div class="col-start-1 row-start-1">
        <div
          class="focus-ring project-carousel-track glass-card overflow-x-auto overflow-y-hidden overscroll-x-contain rounded-3xl"
          data-carousel-track
          tabindex="0"
          aria-label="Projects"
        >
          {
            projects.map((project, index) => (
              <ProjectPanel
                project={project}
                index={index}
                total={projects.length}
              />
            ))
          }
        </div>
      </div>
    </div>
  </div>

  <p class="project-carousel-hint" aria-hidden="true">Swipe to explore</p>

  <ProjectCarouselNav projects={projectMeta} position="bottom" />
</section>

<script>
  import { bindProjectCarousel } from '@/lib/projectCarouselRuntime';

  bindProjectCarousel();
</script>

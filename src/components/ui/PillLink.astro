---
import { isSafeExternalHref, sanitizeHref } from '@/lib/urls';

type Props = {
  href: string;
  external?: boolean;
  class?: string;
  variant?: 'default' | 'pastel';
  toneKey?: string;
};

const {
  href,
  external,
  class: className = '',
  variant = 'default',
  toneKey: _toneKey,
  ...rest
} = Astro.props as Props & Record<string, unknown>;
const normalizedHref = sanitizeHref(href);
const isExternal = external ?? isSafeExternalHref(normalizedHref);
---

<a
  href={normalizedHref}
  target={isExternal ? '_blank' : undefined}
  rel={isExternal ? 'noreferrer noopener' : undefined}
  {...rest}
  class:list={[
    'focus-ring pill-link inline-flex items-center gap-2 rounded-[var(--site-radius-control)] px-3 py-1.5 text-sm font-sans text-base-content/80',
    variant === 'pastel' ? 'pill-link--pastel' : '',
    className,
  ]}
>
  <slot />
</a>

<style>
  .pill-link {
    border: 1px solid transparent;
    background:
      linear-gradient(
        150deg,
        color-mix(in oklab, var(--site-surface) 74%, transparent),
        color-mix(in oklab, var(--site-surface-strong) 86%, transparent)
      ),
      color-mix(in oklab, var(--site-surface) 50%, transparent);
    transition:
      transform 220ms cubic-bezier(0.22, 1, 0.36, 1),
      border-color 220ms ease,
      color 220ms ease,
      background-color 260ms ease;
    will-change: transform;
  }
  .pill-link:hover {
    border-color: color-mix(in oklab, var(--site-accent) 36%, transparent);
    color: var(--site-text);
    background:
      linear-gradient(
        150deg,
        color-mix(in oklab, var(--site-accent) 20%, transparent),
        color-mix(in oklab, var(--site-accent-soft) 18%, transparent)
      ),
      color-mix(in oklab, var(--site-surface) 55%, transparent);
    transform: translateY(-1px);
  }
  .pill-link:active {
    transform: translateY(0);
  }
  .pill-link--pastel {
    border-color: transparent;
    background:
      linear-gradient(
        145deg,
        color-mix(in oklab, var(--site-accent) 24%, transparent),
        color-mix(in oklab, var(--site-accent-soft) 20%, transparent)
      ),
      color-mix(in oklab, var(--site-surface) 45%, transparent);
    color: color-mix(in oklab, var(--site-text) 95%, transparent);
  }
  .pill-link--pastel:hover {
    border-color: color-mix(in oklab, var(--site-accent) 44%, transparent);
    background:
      linear-gradient(
        145deg,
        color-mix(in oklab, var(--site-accent) 34%, transparent),
        color-mix(in oklab, var(--site-accent-soft) 30%, transparent)
      ),
      color-mix(in oklab, var(--site-surface) 50%, transparent);
    color: var(--site-text);
    transform: translateY(-1px);
  }
</style>

---
import { hashToHue } from '@/lib/colors';

type Props = {
  href: string;
  external?: boolean;
  class?: string;
  variant?: 'default' | 'pastel';
  toneKey?: string;
};

const {
  href,
  external,
  class: className = '',
  variant = 'default',
  toneKey,
} = Astro.props as Props;
const hasScheme = (value: string) => /^[a-z][a-z0-9+.-]*:/i.test(value);
const isExternal = external ?? hasScheme(href);
const pastelHue = variant === 'pastel' ? hashToHue(toneKey ?? href) : undefined;
---

<a
  href={href}
  target={isExternal ? '_blank' : undefined}
  rel={isExternal ? 'noreferrer noopener' : undefined}
  class:list={[
    'pill-link inline-flex items-center gap-2 rounded-full border border-base-content/15 bg-base-content/5 px-3 py-1 text-sm font-sans text-base-content/70 transition-colors hover:border-base-content/30 hover:text-base-content focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-base-content/40',
    variant === 'pastel' ? 'pill-link--pastel' : '',
    className,
  ]}
  style={pastelHue ? `--pill-hue:${pastelHue};` : undefined}
>
  <slot />
</a>

<style>
  .pill-link--pastel {
    background-color: hsl(var(--pill-hue) 65% 60% / 0.2);
    border-color: transparent;
    color: hsl(var(--pill-hue) 70% 82%);
  }
  .pill-link--pastel:hover {
    background-color: hsl(var(--pill-hue) 65% 60% / 0.3);
    color: hsl(var(--pill-hue) 75% 90%);
  }
</style>

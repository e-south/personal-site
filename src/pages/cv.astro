---
import Layout from '@/layouts/Layout.astro';
import { experiences, education, skills } from '@/data/cv';
import CvTimeline from '@/components/ui/CvTimeline.astro';
import List from '@/components/ui/List.astro';
import PublicationsList from '@/components/ui/PublicationsList.astro';
import { getPapers } from '@/lib/content';
import { parseISODate } from '@/lib/dates';
import { profile } from '@/settings';

import type { Experience, Education } from '@/types/cv';

const sortByEndDate = <T extends { start: string; end?: string | null }>(
  a: T,
  b: T,
) => {
  const endA = a.end ?? a.start;
  const endB = b.end ?? b.start;
  return parseISODate(endB).getTime() - parseISODate(endA).getTime();
};

const orderedExperiences: Experience[] = [...experiences].sort(sortByEndDate);
const orderedEducations: Education[] = [...education].sort(sortByEndDate);

const orderedPublications = await getPapers();
---

<Layout>
  {
    orderedEducations.length > 0 && (
      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6 border-b pb-2">Education</h2>
        <CvTimeline elements={orderedEducations} colored={true} />
      </section>
    )
  }

  {
    orderedExperiences.length > 0 && (
      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6 border-b pb-2">Experiences</h2>
        <CvTimeline elements={orderedExperiences} colored={true} />
      </section>
    )
  }

  {
    orderedPublications.length > 0 && (
      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6 border-b pb-2">Publications</h2>
        <PublicationsList
          elements={orderedPublications}
          highlightName={profile.authorName}
        />
      </section>
    )
  }

  {
    skills.length > 0 && (
      <section class="mb-12">
        <List listTitle="Skills" listItems={skills} />
      </section>
    )
  }
</Layout>

---
import Layout from '@/layouts/Layout.astro';
import { withBase } from '@/lib/urls';
import { getEntry } from 'astro:content';
import PillLink from '@/components/ui/PillLink.astro';

const cvPath = withBase('/cv/Eric_South_CV.pdf');
const cvEntry = await getEntry('cv', 'cv');
const pageEntry = await getEntry('site', 'cv');
const updated =
  cvEntry?.data.updated &&
  cvEntry.data.updated.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
const pageData = pageEntry?.data;
const title = pageData?.title ?? 'CV';
const intro =
  pageData?.intro ??
  'For the full academic CV, view or download the PDF below.';
const downloadLabel = pageData?.downloadLabel ?? 'Download PDF';
---

<Layout title={title}>
  <div class="mx-auto w-full max-w-4xl space-y-10">
    <header class="space-y-3">
      <h1 class="text-4xl sm:text-5xl font-semibold">{title}</h1>
      <p class="text-base-content/70">{intro}</p>
      <PillLink href={cvPath}>{downloadLabel}</PillLink>
      {updated && <p class="text-sm text-base-content/60">Updated {updated}</p>}
    </header>

    <div class="rounded-2xl border border-base-content/15 bg-base-200/20 p-4">
      <iframe src={cvPath} title="CV PDF" class="h-[70vh] w-full rounded-xl"
      ></iframe>
    </div>
  </div>
</Layout>

---
import Pagination from '@/components/ui/Pagination.astro';
import Layout from '@/layouts/Layout.astro';
import { Image } from 'astro:assets';
import { template } from '@/settings';
import { getBlogListItems } from '@/lib/content';
import type { BlogListItem } from '@/lib/content';

type PageData = {
  data: BlogListItem[];
  url: {
    prev?: string;
    next?: string;
  };
};

type Paginate = (
  data: BlogListItem[],
  options: { pageSize: number },
) => Array<{ params: { page?: string }; props: { page: PageData } }>;

export async function getStaticPaths({ paginate }: { paginate: Paginate }) {
  const posts: BlogListItem[] = await getBlogListItems();

  return paginate(posts, {
    pageSize: template.postPerPage,
  });
}
const { page } = Astro.props as { page: PageData };
---

<Layout title="Blog">
  <div>
    <h1 class="text-3xl font-bold mb-8">Blog Posts</h1>
    <div class="grid gap-8">
      {
        page.data.map((post) => (
          <article class="card bg-base-200 transition-all overflow-hidden">
            {post.cover && (
              <figure class="aspect-video">
                <Image
                  src={post.cover}
                  alt={post.coverAlt ?? post.title}
                  class="w-full h-full object-cover"
                />
              </figure>
            )}
            <div class="card-body">
              <div class="flex justify-between items-start">
                <h2 class="card-title text-xl">
                  <a href={post.slug} class="hover:text-accent">
                    {post.title}
                  </a>
                </h2>
                {post.badge && (
                  <div class="badge badge-accent badge-outline p-4">
                    {post.badge}
                  </div>
                )}
              </div>
              <time
                datetime={post.date.toISOString()}
                class="text-sm text-base-content/71"
              >
                {post.date.toLocaleDateString('en-US', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric',
                })}
              </time>
              <p class="mt-4">{post.excerpt}</p>
              <div class="card-actions justify-end">
                <a
                  href={post.slug}
                  class="btn btn-sm btn-secondary text-secondary-content"
                >
                  Read More
                </a>
              </div>
            </div>
          </article>
        ))
      }
    </div>

    <div class="flex justify-center mt-8">
      <Pagination page={page} />
    </div>
  </div>
</Layout>

---
import Pagination from '@/components/ui/Pagination.astro';
import Layout from '@/layouts/Layout.astro';
import { template } from '@/settings';
import { getBlogListItems } from '@/lib/content';
import { getEntry } from 'astro:content';
import type { BlogListItem } from '@/lib/content';
import BlogPostList from '@/components/blog/BlogPostList.astro';
import SubscribeCta from '@/components/ui/SubscribeCta.astro';
import { requireEntry } from '@/lib/require';

type PageData = {
  data: BlogListItem[];
  url: {
    prev?: string;
    next?: string;
  };
};

type Paginate = (
  data: BlogListItem[],
  options: { pageSize: number },
) => Array<{ params: { page?: string }; props: { page: PageData } }>;

export async function getStaticPaths({ paginate }: { paginate: Paginate }) {
  const posts: BlogListItem[] = await getBlogListItems();

  return paginate(posts, {
    pageSize: template.postPerPage,
  });
}
const { page } = Astro.props as { page: PageData };
const blogEntry = requireEntry(
  await getEntry('page-blog', 'blog'),
  'page-blog/blog',
);
const blogData = blogEntry.data;
const title = blogData.title;
const intro = blogData.intro;
---

<Layout title={title}>
  <div class="mx-auto max-w-3xl space-y-12">
    <header class="space-y-3">
      <h1
        class="page-main-header page-main-header--blog text-4xl sm:text-5xl font-semibold"
      >
        {title}
      </h1>
      <p class="text-base-content/70">{intro}</p>
    </header>

    <SubscribeCta />

    <BlogPostList
      posts={page.data}
      articleClass="section-divider-bottom pb-10 last:pb-0"
    />

    <div class="flex justify-center">
      <Pagination page={page} />
    </div>
  </div>
</Layout>
